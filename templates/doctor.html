<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Dashboard - InsuRx</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/doctorstyle.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <header class="header">
        <div class="header-content">
            <div class="app-info">
                <div class="app-icon" style="background:transparent;border:none;box-shadow:none;">
                    <img src="{{ url_for('static', filename='img/insurx-logo.png') }}" alt="InsuRx" style="height:36px;object-fit:contain;display:block;"/>
                </div>
                <div class="app-details"></div>
            </div>
            <div class="profile-actions">
                <button class="profile-btn" onclick="showProfileModal()" aria-label="Profile">
                    <i class="fas fa-user-circle"></i>
                </button>
            </div>
        </div>
    </header>

    <nav class="nav-tabs">
        <div class="nav-container">
            <button class="nav-tab active" data-tab="submit-request">
                <i class="fas fa-plus-circle"></i>
                Submit Request
            </button>
            <button class="nav-tab" data-tab="my-requests">
                <i class="fas fa-list-alt"></i>
                My Requests
            </button>
            <button class="nav-tab" data-tab="appeals">
                <i class="fas fa-gavel"></i>
                Appeals
            </button>
        </div>
    </nav>

    <main class="main-content">
        <div id="submit-request" class="tab-content active">
            <div class="content-header">
                <h2><i class="fas fa-plus-circle"></i> Submit New Request</h2>
                <p>Complete the form below to submit a new service request for your patient.</p>
            </div>

            <form id="request-form" class="request-form" method="POST" action="#" onsubmit="return false;" data-custom-submit="true">
                <div class="form-section">
                    <h3><i class="fas fa-user-injured"></i> Patient Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="patient-id" class="required">Patient ID</label>
                            <input type="text" id="patient-id" placeholder="e.g., P001" required>
                        </div>
                        <div class="form-group">
                            <label for="patient-name" class="required">Patient Name</label>
                            <input type="text" id="patient-name" placeholder="Full Name" required>
                        </div>
                        <div class="form-group">
                            <label for="patient-age" class="required">Age</label>
                            <input type="number" id="patient-age" min="0" max="150" placeholder="Age" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="patient-gender" class="required">Gender</label>
                            <select id="patient-gender" required>
                                <option value="">Select Gender</option>
                                <option value="M">Male</option>
                                <option value="F">Female</option>
                                <option value="O">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="patient-state" class="required">State</label>
                            <select id="patient-state" required>
                                <option value="">Select State</option>
                                <option value="CA">California</option>
                                <option value="NY">New York</option>
                                <option value="TX">Texas</option>
                                <option value="FL">Florida</option>
                                <option value="IL">Illinois</option>
                                <option value="OH">Ohio</option>
                                <option value="WA">Washington</option>
                                <option value="AZ">Arizona</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Patient Information (unchanged) -->

                <div class="form-section">
                    <h3><i class="fas fa-stethoscope"></i> Diagnosis & Request Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="diagnosis" class="required">Diagnosis Code</label>
                            <input type="text" id="diagnosis" placeholder="e.g., E78.5, E11.9, M05.79" required
                                list="diagnosis-suggestions">
                            <datalist id="diagnosis-suggestions">
                                <option value="E78.5">
                                <option value="E78.0">
                                <option value="E78.2">
                                <option value="E78.01">
                                <option value="E11.9">
                                <option value="E11.65">
                                <option value="M05.79">
                                <option value="M45.9">
                                <option value="K50.9">
                                <option value="L40.0">
                                <option value="L40.5">
                                <option value="C92.1">
                                <option value="C83.3">
                                <option value="C34.9">
                                <option value="C43.9">
                                <option value="C90.0">
                                <option value="G93.1">
                                <option value="G20">
                                <option value="M79.3">
                                <option value="I21.9">
                            </datalist>
                        </div>
                    </div>
                    <!-- Clinical criteria -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="prior-therapies">Prior Therapies (comma-separated)</label>
                            <input type="text" id="prior-therapies"
                                placeholder="e.g., Metformin, High-Intensity Statin">
                            <small class="hint">Only include if applicable</small>
                        </div>
                        <div class="form-group">
                            <label for="hba1c">HbA1c (%)</label>
                            <input type="number" id="hba1c" step="0.1" min="0" max="20" placeholder="e.g., 7.5">
                        </div>
                        <div class="form-group">
                            <label for="bmi">BMI</label>
                            <input type="number" id="bmi" step="0.1" min="5" max="80" placeholder="e.g., 32.5">
                        </div>
                        <div class="form-group">
                            <label for="ldl">LDL (mg/dL)</label>
                            <input type="number" id="ldl" step="1" min="0" max="500" placeholder="e.g., 140">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-procedures"></i> Service Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="service-type" class="required">Service Type</label>
                            <select id="service-type" required onchange="updateServiceNamePlaceholder()">
                                <option value="">Select Service Type</option>
                                <option value="medication">Medication</option>
                                <option value="imaging">Imaging</option>
                                <option value="procedure">Procedure</option>
                                <option value="dme">DME</option>
                                <option value="emergency">Emergency</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="service-name" class="required">Service Name</label>
                            <input type="text" id="service-name"
                                placeholder="e.g., Atorvastatin, Semaglutide, Evolocumab" required
                                list="service-suggestions">
                            <datalist id="service-suggestions">
                                <option value="Atorvastatin">
                                <option value="Rosuvastatin">
                                <option value="Simvastatin">
                                <option value="Pravastatin">
                                <option value="Lovastatin">
                                <option value="Semaglutide">
                                <option value="Dulaglutide">
                                <option value="Tirzepatide">
                                <option value="Evolocumab">
                                <option value="Alirocumab">
                                <option value="Adalimumab">
                                <option value="Etanercept">
                                <option value="Infliximab">
                                <option value="Ustekinumab">
                                <option value="Secukinumab">
                                <option value="Imatinib">
                                <option value="Rituximab">
                                <option value="Pembrolizumab">
                                <option value="Nivolumab">
                                <option value="Lenalidomide">
                                <option value="Celecoxib">
                                <option value="Emergency Cardiac Catheterization">
                                <option value="MRI Brain with Contrast">
                                <option value="Wheelchair - Standard">
                                <option value="Arthroscopic Knee Surgery">
                            </datalist>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-shield-alt"></i> Insurance & Plan Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="plan-type" class="required">Plan Type</label>
                            <select id="plan-type" required>
                                <option value="">Select Plan Type</option>
                                <option value="ppo">PPO</option>
                                <option value="hmo">HMO</option>
                                <option value="epo">EPO</option>
                                <option value="pos">POS</option>
                            </select>
                        </div>
                    </div>
                </div>


                <div class="form-actions">
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-paper-plane"></i>
                        Submit Request
                    </button>
                    <button type="button" class="reset-btn" onclick="resetForm()">
                        <i class="fas fa-undo"></i>
                        Reset Form
                    </button>
                </div>
            </form>
        </div>

        <div id="my-requests" class="tab-content">
            <div class="content-header">
                <h2><i class="fas fa-list-alt"></i> My Requests</h2>
                <p>View and manage all your submitted service requests.</p>
            </div>

            <div class="table-container">
                <table class="requests-table">
                    <thead>
                        <tr>
                            <th>Item ID</th>
                            <th>Patient</th>
                            <th>Diagnosis</th>
                            <th>Status</th>
                            <th>Risk Level</th>
                            <th>Reason</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="requests-tbody">
                        <!-- Request data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="appeals" class="tab-content">
            <div class="content-header">
                <h2><i class="fas fa-gavel"></i> Appeals</h2>
                <p>Manage denied requests and review ML-predicted appeal levels.</p>
            </div>

            <div class="appeals-container">
                <div class="appeals-list" id="appeals-list"></div>

                <div class="table-container" style="margin-top:16px;">
                    <table class="requests-table">
                        <thead>
                            <tr>
                                <th>Appeal/Request</th>
                                <th>Patient</th>
                                <th>Service</th>
                                <th>Original Status</th>
                                <th>Appeal Level</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="appeals-tbody">
                            <!-- Appeals will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Profile Information</h3>
                <span class="close" onclick="closeProfileModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="profile-info">
                    <div class="profile-field">
                        <label>Doctor Name:</label>
                        <span id="profile-username">Dr. Sarah Johnson</span>
                    </div>
                    <div class="profile-field">
                        <label>Hospital:</label>
                        <span>City General Hospital</span>
                    </div>
                    <div class="profile-field">
                        <label>Specialty:</label>
                        <span>Cardiology</span>
                    </div>
                    <div class="profile-field">
                        <label>License Number:</label>
                        <span>MD123456</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="upload-docs-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Upload Documentation</h3>
                <span class="close" onclick="closeUploadModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="request-info">
                    <h4 id="upload-request-id">Request: Loading...</h4>
                    <p id="upload-request-details">Patient: Loading... | Service: Loading...</p>
                </div>
                <div class="upload-area">
                    <div class="file-drop-zone" id="modal-file-drop-zone">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Drag and drop files here or click to browse</p>
                        <input type="file" id="modal-file-input" multiple accept=".pdf,.jpg,.jpeg,.png"
                            style="display: none;">
                        <button type="button" class="browse-btn"
                            onclick="document.getElementById('modal-file-input').click()">
                            Browse Files
                        </button>
                    </div>
                    <div id="modal-file-list" class="file-list"></div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="submit-btn modal-submit-btn" onclick="submitUploadedFiles()">
                        <i class="fas fa-upload"></i>
                        Submit Documentation
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="appeal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Submit Appeal</h3>
                <span class="close" onclick="closeAppealModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="request-info">
                    <h4 id="appeal-request-id">Request: Loading...</h4>
                    <p id="appeal-request-details">Patient: Loading... | Service: Loading...</p>
                </div>
                <div class="appeal-form">
                    <div class="form-group">
                        <label for="appeal-notes">Appeal Reason</label>
                        <textarea id="appeal-notes" rows="4"
                            placeholder="Please provide detailed reasoning for this appeal..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="appeal-evidence">Supporting Evidence</label>
                        <textarea id="appeal-evidence" rows="3"
                            placeholder="List any additional evidence or documentation..."></textarea>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="submit-btn appeal-submit-btn" onclick="submitAppealFromModal()">
                        <i class="fas fa-paper-plane"></i>
                        Submit Appeal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="notification-container"></div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        (function () {
            try {
                const user = JSON.parse(localStorage.getItem('cts_user') || '{}');
                if (user && user.username) {
                    const top = document.getElementById('top-username');
                    const prof = document.getElementById('profile-username');
                    if (top) top.textContent = user.username;
                    if (prof) prof.textContent = user.username;
                }
            } catch (e) { }
        })();
    </script>
    <script src="{{ url_for('static', filename='js/notification.js') }}"></script>
    <script src="{{ url_for('static', filename='js/doctorscript.js') }}"></script>
</body>

</html>