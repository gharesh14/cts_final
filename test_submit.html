<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Submit Function</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; }
        input, select { width: 200px; padding: 5px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Test Submit Function</h1>
    <form id="test-form">
        <div class="form-group">
            <label for="patient-id">Patient ID:</label>
            <input type="text" id="patient-id" value="P001" required>
        </div>
        <div class="form-group">
            <label for="patient-name">Patient Name:</label>
            <input type="text" id="patient-name" value="John Doe" required>
        </div>
        <div class="form-group">
            <label for="patient-age">Age:</label>
            <input type="number" id="patient-age" value="45" required>
        </div>
        <div class="form-group">
            <label for="patient-gender">Gender:</label>
            <select id="patient-gender" required>
                <option value="M">Male</option>
                <option value="F">Female</option>
            </select>
        </div>
        <div class="form-group">
            <label for="patient-state">State:</label>
            <select id="patient-state" required>
                <option value="CA">California</option>
                <option value="NY">New York</option>
            </select>
        </div>
        <div class="form-group">
            <label for="risk-score">Risk Score:</label>
            <input type="number" id="risk-score" value="0.5" step="0.1" min="0" max="1" required>
        </div>
        <div class="form-group">
            <label for="diagnosis">Diagnosis Code:</label>
            <input type="text" id="diagnosis" value="E78.5" required>
        </div>
        <div class="form-group">
            <label for="diagnosis-category">Diagnosis Category:</label>
            <select id="diagnosis-category" required>
                <option value="endocrine">Endocrine</option>
                <option value="cardiovascular">Cardiovascular</option>
            </select>
        </div>
        <div class="form-group">
            <label for="service-type">Service Type:</label>
            <select id="service-type" required>
                <option value="medication">Medication</option>
                <option value="imaging">Imaging</option>
            </select>
        </div>
        <div class="form-group">
            <label for="service-name">Service Name:</label>
            <input type="text" id="service-name" value="Atorvastatin" required>
        </div>
        <div class="form-group">
            <label for="service-code">Service Code:</label>
            <input type="text" id="service-code" value="NDC-12345-678-90" required>
        </div>
        <div class="form-group">
            <label for="tier">Tier:</label>
            <select id="tier" required>
                <option value="1">Tier 1</option>
                <option value="2">Tier 2</option>
            </select>
        </div>
        <div class="form-group">
            <label for="copay">Copay:</label>
            <input type="number" id="copay" value="10.00" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="estimated-cost">Estimated Cost:</label>
            <input type="number" id="estimated-cost" value="150.00" step="0.01" required>
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" id="requires-pa"> Requires Prior Authorization
            </label>
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" id="is-high-cost"> High Cost Service
            </label>
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" id="step-therapy"> Step Therapy Required
            </label>
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" id="qty-limit"> Quantity Limit
            </label>
        </div>
        <div class="form-group">
            <label for="plan-type">Plan Type:</label>
            <select id="plan-type" required>
                <option value="ppo">PPO</option>
                <option value="hmo">HMO</option>
            </select>
        </div>
        <div class="form-group">
            <label for="deductible">Deductible:</label>
            <input type="number" id="deductible" value="1000.00" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="coinsurance">Coinsurance (%):</label>
            <input type="number" id="coinsurance" value="20.0" step="0.1" required>
        </div>
        <div class="form-group">
            <label for="out-of-pocket-max">Out-of-Pocket Max:</label>
            <input type="number" id="out-of-pocket-max" value="5000.00" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="member-months">Member Months:</label>
            <input type="number" id="member-months" value="12" min="1" max="12" required>
        </div>
        <div class="form-group">
            <label for="prior-denials">Prior Denials:</label>
            <input type="number" id="prior-denials" value="0" min="0" required>
        </div>
        <button type="submit">Test Submit</button>
    </form>
    
    <div id="result"></div>
    
    <!-- Notification Container -->
    <div id="notification-container"></div>

    <script src="static/js/notification.js"></script>
    <script>
        document.getElementById('test-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Submitting...</p>';
            
            try {
                const requestData = {
                    patientId: document.getElementById('patient-id').value,
                    patientName: document.getElementById('patient-name').value,
                    patientAge: document.getElementById('patient-age').value,
                    patientGender: document.getElementById('patient-gender').value,
                    patientState: document.getElementById('patient-state').value,
                    riskScore: document.getElementById('risk-score').value,
                    icdCode: document.getElementById('diagnosis').value,
                    diagnosisCategory: document.getElementById('diagnosis-category').value,
                    serviceType: document.getElementById('service-type').value,
                    serviceName: document.getElementById('service-name').value,
                    serviceCode: document.getElementById('service-code').value,
                    tier: document.getElementById('tier').value,
                    copay: document.getElementById('copay').value,
                    estimatedCost: document.getElementById('estimated-cost').value,
                    requiresPa: document.getElementById('requires-pa').checked,
                    isHighCost: document.getElementById('is-high-cost').checked,
                    stepTherapy: document.getElementById('step-therapy').checked,
                    qtyLimit: document.getElementById('qty-limit').checked,
                    planType: document.getElementById('plan-type').value,
                    deductible: document.getElementById('deductible').value,
                    coinsurance: document.getElementById('coinsurance').value,
                    outOfPocket: document.getElementById('out-of-pocket-max').value,
                    memberMonths: document.getElementById('member-months').value,
                    priorDenials: document.getElementById('prior-denials').value
                };
                
                const requestPayload = {
                    patient: {
                        patient_id: requestData.patientId,
                        patient_name: requestData.patientName,
                        age: parseInt(requestData.patientAge),
                        gender: requestData.patientGender,
                        state: requestData.patientState,
                        risk_score: parseFloat(requestData.riskScore)
                    },
                    request: {
                        diagnosis: requestData.icdCode,
                        diagnosis_category: requestData.diagnosisCategory,
                        plan_type: requestData.planType,
                        deductible: parseFloat(requestData.deductible),
                        coinsurance: parseFloat(requestData.coinsurance),
                        out_of_pocket_max: parseFloat(requestData.outOfPocket),
                        member_months: parseInt(requestData.memberMonths),
                        prior_denials: parseInt(requestData.priorDenials)
                    },
                    service: {
                        service_type: requestData.serviceType,
                        service_name: requestData.serviceName,
                        service_code: requestData.serviceCode,
                        tier: parseInt(requestData.tier),
                        requires_pa: requestData.requiresPa,
                        is_high_cost: requestData.isHighCost,
                        step_therapy: requestData.stepTherapy,
                        qty_limit: requestData.qtyLimit,
                        copay: parseFloat(requestData.copay),
                        estimated_cost: parseFloat(requestData.estimatedCost)
                    }
                };
                
                console.log('Sending payload:', requestPayload);
                
                const response = await fetch('http://localhost:5000/requests', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestPayload)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showNotification(`Success! Request submitted. Status: ${result.approval_status}`, 'success');
                    resultDiv.innerHTML = `<p class="success">Success! Request submitted. Status: ${result.approval_status}</p>`;
                } else {
                    showNotification(`Error: ${result.error || 'Unknown error'}`, 'error');
                    resultDiv.innerHTML = `<p class="error">Error: ${result.error || 'Unknown error'}</p>`;
                }
                
            } catch (error) {
                console.error('Error:', error);
                showNotification(`Network error: ${error.message}`, 'error');
                resultDiv.innerHTML = `<p class="error">Network error: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>
